
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Composition properties of DP &#8212; Data and Information Privacy</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=afe5de03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/dp/2-dp-composition';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Data and Information Privacy</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preli/probability.html">1. Preliminaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anonymizations/intro.html">2. Anonymization techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anonymizations/k-anon.html">3. K-anonymity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anonymizations/utility.html">4. Data utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anonymizations/other-techniques.html">5. Other anonymization techniques</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapters/dp/2-dp-composition.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/dp/2-dp-composition.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Composition properties of DP</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sequential-composition">Sequential composition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parallel-composition">Parallel composition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram-functions">Histogram functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contingency-table">Contingency table</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#post-processing-guarantee">Post-processing guarantee</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">adult</span> <span class="o">=</span> <span class="n">adult</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../datasets/adult_with_pii.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="composition-properties-of-dp">
<h1>Composition properties of DP<a class="headerlink" href="#composition-properties-of-dp" title="Link to this heading">#</a></h1>
<p>Note that, the privacy guarantee from DP applies to a single query. That means, if a mechanism satisfies <span class="math notranslate nohighlight">\(\epsilon\)</span>-DP, it bounds the query result from two neighboring datasets by <span class="math notranslate nohighlight">\(\epsilon\)</span> when sending the query only once. This privacy guarantee will not hold for subsequent queries. But in real world, we rarely query a dataet only once. We send many different queries, and even the same query multiple times. Additionally, for some queries, the whole dataset is not required, i.e., the query result can be computed using a part of the dataset. All these changes the privacy guarantee of DP.</p>
<section id="sequential-composition">
<h2>Sequential composition<a class="headerlink" href="#sequential-composition" title="Link to this heading">#</a></h2>
<p>Sequential composition bounds the total privacy cost of releasing multiple results of differentially private mechanisms on the same input data. Imagine that we first query the dataset about the average age of people working as tech support ( query function <span class="math notranslate nohighlight">\(F_1\)</span>), and then we query the average number of working hours for them (query function  <span class="math notranslate nohighlight">\(F_2\)</span>). If  <span class="math notranslate nohighlight">\(F_1\)</span> and  <span class="math notranslate nohighlight">\(F_2\)</span> both goes through a randomization mechanism to achieve differential privacy, mechanisms <span class="math notranslate nohighlight">\(M_1\)</span> and <span class="math notranslate nohighlight">\(M_2\)</span>, resepectively, with privacy budgets <span class="math notranslate nohighlight">\(\epsilon_1\)</span> and <span class="math notranslate nohighlight">\(\epsilon_2\)</span>, then the total privacy cost for both queries combined will be <span class="math notranslate nohighlight">\(\epsilon_1\)</span> + <span class="math notranslate nohighlight">\(\epsilon_2\)</span>. Thus, as the number of queries goes up, the privacy budget or cost increases, i.e., the privacy protection decreases.</p>
<hr class="docutils" />
<p><strong>Theorem: Sequential compossition</strong></p>
<p>If mechanism <span class="math notranslate nohighlight">\(M_1\)</span> satisfies <span class="math notranslate nohighlight">\(\epsilon_1\)</span>-differential privacy and mechahism <span class="math notranslate nohighlight">\(M_2\)</span> satisfies <span class="math notranslate nohighlight">\(\epsilon_2\)</span>-differential privacy then the mechanism <span class="math notranslate nohighlight">\(M=M_1 + M_2\)</span> will satisfy <span class="math notranslate nohighlight">\(\epsilon_1\)</span> + <span class="math notranslate nohighlight">\(\epsilon_2\)</span>-differential privacy.</p>
<hr class="docutils" />
<p>See <span id="id1">[<a class="reference internal" href="0-dp-main.html#id1044" title="Ninghui Li, Min Lyu, Dong Su, and Weining Yang. Differential Privacy: From Theory to Practice. Springer, 2017.">LLSY17</a>]</span> for the proof.</p>
<p>Sequential composition is a vital property of differential privacy because it allows algorithms to consult
the data multiple times or conduct separate analysis on the data and then compute the total privacy cost for all these analyses.</p>
<p>The bound on privacy cost given by sequential composition is an upper bound - the actual privacy cost of two particular
differentially private releases may be smaller than this, but never larger. Let’s see how the privacy budgets “add up”  when we combine two differentially private results together through the examples below (Taken from <span id="id2">[<a class="reference internal" href="0-dp-main.html#id1045">NA21</a>]</span>. Note that, this sequential composition properties work for any DP mechanism (not just Laplace mechanism).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">epsilon2</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">epsilon_total</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># satisfies 1-differential privacy</span>
<span class="k">def</span> <span class="nf">F1</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">epsilon1</span><span class="p">)</span>
<span class="c1"># satisfies 1-differential privacy</span>
<span class="k">def</span> <span class="nf">F2</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">epsilon2</span><span class="p">)</span>
<span class="c1"># satisfies 2-differential privacy</span>
<span class="k">def</span> <span class="nf">F3</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">epsilon_total</span><span class="p">)</span>
<span class="c1"># satisfies 2-differential privacy, by sequential composition</span>
<span class="k">def</span> <span class="nf">F_combined</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">F1</span><span class="p">()</span> <span class="o">+</span> <span class="n">F2</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">f1_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">F1</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
<span class="n">f2_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">F2</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
<span class="n">f3_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">F3</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
<span class="n">fc_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">F_combined</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">f1_vals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;F1&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">f2_vals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s2">&quot;F2&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">f3_vals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s2">&quot;F3&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">fc_vals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s2">&quot;F_combined&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e8ba8026abd892462613430ea73cd593d2e88e4392b8a31a983753fa166224d4.png" src="../../_images/e8ba8026abd892462613430ea73cd593d2e88e4392b8a31a983753fa166224d4.png" />
</div>
</div>
<p>In the aboge graph, for F1 and F2, we see that the distributions of their outputs look pretty similar. But F3 is narrower than the two, i.e. less variance (and hence less privacy). F3 is also narrower than F_combined, proving the point that actual privacy loss may be lower than the theoretical upper bound.</p>
</section>
<section id="parallel-composition">
<h2>Parallel composition<a class="headerlink" href="#parallel-composition" title="Link to this heading">#</a></h2>
<p>Parallel composition is based on the idea of splitting your dataset into disjoint chunks and running a differentially
private mechanism on each chunk separately. Since the chunks are disjoint, each individual’s data appears in exactly one
chunk - so even if there are 𝑘 chunks in total (and therefore 𝑘 runs of the mechanism), the mechanism runs exactly once
on the data of each individual. Formally,</p>
<hr class="docutils" />
<p>If mechanism <span class="math notranslate nohighlight">\(M\)</span> satisfies <span class="math notranslate nohighlight">\(\epsilon\)</span>-differential privacy and the dataste <span class="math notranslate nohighlight">\(D\)</span> is split into <span class="math notranslate nohighlight">\(k\)</span> disjoint chunks where <span class="math notranslate nohighlight">\(D\)</span> can be recovered by mergina all chunks, then applying <span class="math notranslate nohighlight">\(M\)</span> to all of these chunks and releasing the results will still satisfy <span class="math notranslate nohighlight">\(\epsilon\)</span>-differential privacy (instead of <span class="math notranslate nohighlight">\(k\epsilon\)</span>-differential privacy like the sequential composition case). More generally, if there are <span class="math notranslate nohighlight">\(k\)</span> mechanisms <span class="math notranslate nohighlight">\(M_1, M_2, M_3, \dots, M_k\)</span> with privacy budgets <span class="math notranslate nohighlight">\(\epsilon_1, \epsilon_2, \epsilon_3, \dots, \epsilon_k\)</span>, then applying these mechanisms on the disjoint chunks will have <span class="math notranslate nohighlight">\(max_{i\in[1,2,3,\dots,k]}\epsilon_i\)</span>-differential privacy.</p>
<hr class="docutils" />
<p>(See <span id="id3">[<a class="reference internal" href="0-dp-main.html#id1044" title="Ninghui Li, Min Lyu, Dong Su, and Weining Yang. Differential Privacy: From Theory to Practice. Springer, 2017.">LLSY17</a>]</span> for the proof.)</p>
<p>A specific scenario is running the same algorithm <span class="math notranslate nohighlight">\(M\)</span> over <span class="math notranslate nohighlight">\(k\)</span> disjoint chunks of a single dataset <span class="math notranslate nohighlight">\(D\)</span>. If <span class="math notranslate nohighlight">\(M\)</span> satisfies <span class="math notranslate nohighlight">\(\epsilon\)</span>-DP, then all <span class="math notranslate nohighlight">\(k\)</span> queries also jointly satisfy <span class="math notranslate nohighlight">\(\epsilon\)</span>-DP. This is a much better privacy guarantee than sequential composition (where we would have <span class="math notranslate nohighlight">\(k\epsilon\)</span>-DP guarantee.</p>
<blockquote>
<div><p>The formal definition matches up with our intuition - if each participant in the dataset contributes one row to <span class="math notranslate nohighlight">\(D\)</span>, then this row will appear in exactly one of the chunks <span class="math notranslate nohighlight">\(d_1, d_2, \dots, d_k\)</span>. That means <span class="math notranslate nohighlight">\(M\)</span> will only “see” this participant’s data one time, meaning a privacy cost of <span class="math notranslate nohighlight">\(\epsilon\)</span> is appropriate for that individual. Since this property holds for all individuals, the privacy cost
is <span class="math notranslate nohighlight">\(\epsilon\)</span> for everyone.</p>
</div></blockquote>
<section id="histogram-functions">
<h3>Histogram functions<a class="headerlink" href="#histogram-functions" title="Link to this heading">#</a></h3>
<p>In our context, a histogram is an analysis of a dataset which splits the dataset into “bins” based on the value of one of the
data attributes, and counts the number of rows in each bin. For example, a histogram might count the number of people
in the dataset who achieved a particular educational level</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adult</span><span class="p">[</span><span class="s1">&#39;Education&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Education</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>HS-grad</th>
      <td>10501</td>
    </tr>
    <tr>
      <th>Some-college</th>
      <td>7291</td>
    </tr>
    <tr>
      <th>Bachelors</th>
      <td>5355</td>
    </tr>
    <tr>
      <th>Masters</th>
      <td>1723</td>
    </tr>
    <tr>
      <th>Assoc-voc</th>
      <td>1383</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Histograms are particularly interesting for differential privacy because they automatically satisfy parallel composition. Each “bin” in a histogram is defined by a possible value for a data attribute (for example, ‘Education’ ==
‘HS-grad’). It’s impossible for a single row to have two values for an attribute simultaneously, so defining the bins this way guarantees that they will be disjoint. Thus we have satisfied the requirements for parallel composition, and we can use a differentially private mechanism to release all of the bin counts with a total privacy cost of just 𝜖.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># This analysis has a total privacy cost of epsilon = 1, even though we release many results!</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">adult</span><span class="p">[</span><span class="s1">&#39;Education&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Education</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>HS-grad</th>
      <td>10500.450533</td>
    </tr>
    <tr>
      <th>Some-college</th>
      <td>7292.464351</td>
    </tr>
    <tr>
      <th>Bachelors</th>
      <td>5355.627904</td>
    </tr>
    <tr>
      <th>Masters</th>
      <td>1723.185300</td>
    </tr>
    <tr>
      <th>Assoc-voc</th>
      <td>1383.064571</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="contingency-table">
<h3>Contingency table<a class="headerlink" href="#contingency-table" title="Link to this heading">#</a></h3>
<p>A contingency table or cross tabulation (often shortened to crosstab) is like a multi-dimensional histogram. It counts the frequency of rows in the dataset with particular values for more than one attribute at a time. Contingency tables are frequently used to show the relationship between two variables when analyzing data. For example, we might want to see counts based on both education level and gender:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">adult</span><span class="p">[</span><span class="s1">&#39;Education&#39;</span><span class="p">],</span> <span class="n">adult</span><span class="p">[</span><span class="s1">&#39;Sex&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Sex</th>
      <th>Female</th>
      <th>Male</th>
    </tr>
    <tr>
      <th>Education</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10th</th>
      <td>295</td>
      <td>638</td>
    </tr>
    <tr>
      <th>11th</th>
      <td>432</td>
      <td>743</td>
    </tr>
    <tr>
      <th>12th</th>
      <td>144</td>
      <td>289</td>
    </tr>
    <tr>
      <th>1st-4th</th>
      <td>46</td>
      <td>122</td>
    </tr>
    <tr>
      <th>5th-6th</th>
      <td>84</td>
      <td>249</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It’s safe to use parallel composition here, too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">adult</span><span class="p">[</span><span class="s1">&#39;Education&#39;</span><span class="p">],</span> <span class="n">adult</span><span class="p">[</span><span class="s1">&#39;Sex&#39;</span><span class="p">])</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
<span class="n">ct</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Sex</th>
      <th>Female</th>
      <th>Male</th>
    </tr>
    <tr>
      <th>Education</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10th</th>
      <td>294.931313</td>
      <td>637.874352</td>
    </tr>
    <tr>
      <th>11th</th>
      <td>430.987988</td>
      <td>741.435669</td>
    </tr>
    <tr>
      <th>12th</th>
      <td>144.458937</td>
      <td>288.920992</td>
    </tr>
    <tr>
      <th>1st-4th</th>
      <td>45.906080</td>
      <td>122.781184</td>
    </tr>
    <tr>
      <th>5th-6th</th>
      <td>86.048573</td>
      <td>248.433002</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It’s also possible to generate contingency tables of more than 2 variables. Consider what happens each time we add a
variable, though: each of the counts tends to get smaller. Intuitively, as we split the dataset into more chunks, each chunk has fewer rows in it, so all of the counts get smaller. These shrinking counts can have a significant affect on the accuracy of the differentially private results we calculate from them. If we think of things in terms of signal and noise, a large count represents a strong signal - it’s unlikely to be
disrupted too much by relatively weak noise (like the noise we add above), and therefore the results are likely to be useful even after the noise is added. However, a small count represents a weak signal - potentially as weak as the noise itself and after we add the noise, we won’t be able to infer anything useful from the results.
So while it may seem that parallel composition gives us something “for free” (more results for the same privacy cost), that’s not really the case. Parallel composition simply moves the tradeoff between accuracy and privacy along a different axis - as we split the dataset into more chunks and release more results, each result contains a weaker signal, and so it’s less accurate.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This text is <strong>standard</strong> <em>Markdown</em></p>
</div>
</section>
</section>
<section id="post-processing-guarantee">
<h2>Post-processing guarantee<a class="headerlink" href="#post-processing-guarantee" title="Link to this heading">#</a></h2>
<p>The third property of differential privacy we will discuss here is called post-processing. The idea is simple: it’s impossible
to reverse the privacy protection provided by differential privacy by post-processing the data in some way.</p>
<hr class="docutils" />
<p>If <span class="math notranslate nohighlight">\(M(D)\)</span> satisfies <span class="math notranslate nohighlight">\(\epsilon\)</span>-differential privacy then for any (deterministic or randomized) function <span class="math notranslate nohighlight">\(\bar{M}\)</span>, <span class="math notranslate nohighlight">\(\bar{M}M(D)\)</span> satisfies <span class="math notranslate nohighlight">\(\epsilon\)</span>-differential privacy.</p>
<hr class="docutils" />
<p>The above theorem  guarantees that no additional information about the database will be learned
by adversaries through further computations or process on a DP output. Notice that there
is no assumption on the computational power of the adversary in Theorem 1.
DP is phrased in terms of a single individual, but in practice, we may want privacy for groups.
For example, there can be families whose data is correlated or identical or we may consider
multiple entries in the database of a same individual such as multiple hospital records of a
same patient. Following theorem provides privacy of a group of data.</p>
<p>The post-processing property means that it’s always safe to perform arbitrary computations on the output of a differentially private mechanism - there’s no danger of reversing the privacy protection the mechanism has provided. In particular, it’s fine to perform post-processing that might reduce the noise or improve the signal in the mechanism’s output (e.g. replacing negative results with zeros, for queries that shouldn’t return negative results). In fact, many sophisticated differentially private algorithms make use of post-processing to reduce noise and improve the accuracy of their results. The other implication of the post-processing property is that differential privacy provides resistance against privacy attacks based on auxiliary information. For example, the function 𝑔 might contain auxiliary information about elements of the dataset, and attempt to perform a linkage attack using this information. The post-processing property says that such an attack is limited in its effectiveness by the privacy parameter <span class="math notranslate nohighlight">\(\epsilon\)</span>, regardless of the auxiliary information contained in <span class="math notranslate nohighlight">\(\bar M\)</span>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/dp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sequential-composition">Sequential composition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parallel-composition">Parallel composition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram-functions">Histogram functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contingency-table">Contingency table</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#post-processing-guarantee">Post-processing guarantee</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Rakibul Hasan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>